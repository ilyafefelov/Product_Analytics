# Fefelov_PA_assignment_5

## Розрахунок розміру вибірки для біноміальної метрики
### A/B тест для MelodyFlow - функція "Розумні рекомендації плейлистів"

**Студент:** Fefelov  
**Дата:** 31 жовтня 2025 року

---

## Завдання

Розрахувати розмір вибірки для A/B тесту нової функції "Розумні рекомендації плейлистів" у застосунку для стримінгу музики MelodyFlow.

**Первинна метрика:** 7-денне утримання користувачів (7-day retention rate)

---

## Вихідні дані

- **Загальна кількість користувачів:** 1,000,000 (600k безкоштовних + 400k преміум)
- **DAU:** 200,000 користувачів (20% від загальної кількості)
- **Базове утримання на 7-й день:** 41%
- **Середня тривалість сесії:** 15 хвилин
- **ARPPU:** $25/місяць

---

## Гіпотеза

**H₀:** Функція "Розумні рекомендації плейлистів" не впливає на 7-денне утримання.

**H₁:** Функція "Розумні рекомендації плейлистів" збільшує 7-денне утримання.

---

## 1. Визначення параметрів тесту

### 1.1. Minimum Detectable Effect (MDE)

**Обраний MDE:** 5% відносного покращення

**Розрахунок:**
- Базове утримання: p₁ = 0.41 (41%)
- Абсолютне покращення: 0.41 × 0.05 = 0.0205
- Очікуване утримання: p₂ = 0.41 + 0.0205 = **0.4305 (43.05%)**

**Обґрунтування:**
- Баланс між бізнес-значущістю та практичною здійсненністю
- Достатньо амбітний для AI-функції з значним потенціалом
- Реалістичний для виявлення з розумним розміром вибірки

### 1.2. Рівень значущості (α)

**Обраний рівень:** α = 0.05

**Обґрунтування:**
- Стандартний рівень для продуктових A/B тестів
- Дає 95% довірчий інтервал
- Прийнятний ризик помилки I роду (5% шанс хибно позитивного результату)

### 1.3. Статистична потужність (1 - β)

**Обрана потужність:** 80% (β = 0.20)

**Обґрунтування:**
- Індустрійний стандарт (мінімум 80%)
- Дає 80% шанс виявити ефект, якщо він справді існує
- Баланс між надійністю та необхідним розміром вибірки

### 1.4. Тип тесту

**Обраний тип:** Двосторонній тест (two-tailed)

**Обґрунтування:**
- Перевіряє як позитивний, так і негативний вплив
- Більш консервативний та безпечний підхід
- Захищає від несподіваних негативних ефектів
- Стандартна практика для продуктових експериментів

---

## 2. Розрахунок розміру вибірки

### 2.1. Формула

Для порівняння двох пропорцій використовуємо формулу:

```
n = (Z_{α/2} + Z_β)² × [p₁(1-p₁) + p₂(1-p₂)]
    ─────────────────────────────────────────
                  (p₂ - p₁)²
```

### 2.2. Z-значення

- **Z_{α/2} = 1.96** (для α = 0.05, двосторонній тест)
- **Z_β = 0.84** (для потужності 80%)

### 2.3. Покрокові розрахунки

**Крок 1: Чисельник**
```
(Z_{α/2} + Z_β)² = (1.96 + 0.84)² = (2.80)² = 7.84
```

**Крок 2: Дисперсії**
```
p₁(1-p₁) = 0.41 × 0.59 = 0.2419
p₂(1-p₂) = 0.4305 × 0.5695 = 0.2452
```

**Крок 3: Сума дисперсій**
```
0.2419 + 0.2452 = 0.4871
```

**Крок 4: Різниця пропорцій**
```
(p₂ - p₁)² = (0.4305 - 0.41)² = (0.0205)² = 0.00042025
```

**Крок 5: Фінальний розрахунок**
```
n = 7.84 × 0.4871 / 0.00042025
n = 3.819 / 0.00042025
n ≈ 9,097 користувачів на групу
```

### 2.4. Результат

✅ **Розмір вибірки на групу:** 9,097 користувачів (округлено до 9,100)

✅ **Загальний розмір вибірки:** 18,194 користувачів (округлено до 18,200)

---

## 3. Альтернативні сценарії

### Сценарій A: Висока потужність (90%)

**Параметри:** MDE = 5%, α = 0.05, потужність = 90%, Z_β = 1.28

**Розрахунок:**
```
(1.96 + 1.28)² = 10.50
n = 10.50 × 0.4871 / 0.00042025 ≈ 12,179
```
**Результат:** 12,179 на групу, **24,357 загалом**

### Сценарій B: Більший ефект (10%)

**Параметри:** MDE = 10%, p₂ = 0.451, α = 0.05, потужність = 80%

**Розрахунок:**
```
p₂(1-p₂) = 0.451 × 0.549 = 0.2476
Сума = 0.2419 + 0.2476 = 0.4895
(p₂ - p₁)² = (0.041)² = 0.001681
n = 7.84 × 0.4895 / 0.001681 ≈ 2,286
```
**Результат:** 2,286 на групу, **4,572 загалом**

### Сценарій C: Односторонній тест

**Параметри:** MDE = 5%, α = 0.05, потужність = 80%, Z_α = 1.645

**Розрахунок:**
```
(1.645 + 0.84)² = 6.17
n = 6.17 × 0.4871 / 0.00042025 ≈ 7,166
```
**Результат:** 7,166 на групу, **14,332 загалом**

---

## 4. Порівняльна таблиця

| Сценарій | MDE | Потужність | Тип тесту | n/група | Загалом |
|----------|-----|------------|-----------|---------|---------|
| **Основний (рекомендований)** | **5%** | **80%** | **Двосторонній** | **9,097** | **18,194** |
| Висока потужність | 5% | 90% | Двосторонній | 12,179 | 24,357 |
| Більший ефект | 10% | 80% | Двосторонній | 2,286 | 4,572 |
| Односторонній | 5% | 80% | Односторонній | 7,166 | 14,332 |

---

## 5. Практична здійсненність

### 5.1. Оцінка тривалості

**З 50/50 розподілом трафіку:**
- Кожна група отримує: 100,000 користувачів/день
- Необхідно для вибірки: 9,097 користувачів/група
- Час збору: **< 1 дня**
- Період спостереження: **7 днів**
- **Мінімальна тривалість:** 8 днів
- **Рекомендована тривалість:** 14-21 день (для стабільності та врахування тижневих патернів)

### 5.2. Достатність ресурсів

```
Наявно:    200,000 DAU
Потрібно:   18,194 користувачів
Відсоток:   9.1% від DAU
```

**Висновок:** ✅ Тест **ЦІЛКОМ ЗДІЙСНЕННИЙ** з наявною користувацькою базою

---

## 6. Висновки

### 6.1. Рекомендований дизайн тесту

1. **Метрика:** 7-денне утримання (retention rate)
2. **Базовий рівень:** 41%
3. **Очікуваний результат:** 43.05% (+2.05 pp, +5% відносно)
4. **MDE:** 5% відносного покращення
5. **Рівень значущості:** α = 0.05
6. **Статистична потужність:** 80%
7. **Тип тесту:** Двосторонній
8. **Розмір вибірки:** 9,097 користувачів на групу (9,100 округлено)
9. **Загальна вибірка:** 18,194 користувачів (18,200 округлено)
10. **Розподіл трафіку:** 50% контроль / 50% тест
11. **Тривалість:** 14-21 день

### 6.2. Критерії успіху

**Первинний критерій:**
- 7-денне утримання зростає з 41% до ≥43.05%
- p-value < 0.05 (статистична значущість)

**Guardrail метрики (не мають погіршитися):**
- ARPPU (середній дохід з преміум користувача)
- Загальний revenue
- Технічна стабільність (частота помилок)
- Продуктивність застосунку

**Додаткові метрики (для моніторингу):**
- Середня тривалість сесії
- Кількість прослуханих треків
- Engagement з рекомендованими плейлистами
- Частота використання функції

### 6.3. Ризики та мітігація

| Ризик | Мітігація |
|-------|-----------|
| Сезонність і зовнішні події | Подовжити тест до 21 дня, врахувати календар |
| Технічні проблеми | Ретельний моніторинг, план швидкого rollback |
| Novelty effect | Довший період спостереження, пост-ланч аналіз |
| Вибіркова упередженість | Строга рандомізація користувачів |

### 6.4. Наступні кроки

1. ✅ Розрахунок розміру вибірки завершено
2. ⏭️ Налаштування A/B тестової інфраструктури
3. ⏭️ Налаштування трекінгу метрик та дашбордів
4. ⏭️ QA тестування на staging
5. ⏭️ Запуск експерименту
6. ⏭️ Щоденний моніторинг перші 3 дні
7. ⏭️ Тижневі перевірки
8. ⏭️ Фінальний аналіз після 14-21 дня
9. ⏭️ Прийняття рішення про запуск

---

## 7. Верифікація розрахунків

Розрахунки перевірено за допомогою:

1. **Ручний розрахунок** за математичною формулою
2. **Python скрипт** (scipy.stats) - результат: 9,097 ✅
3. **Альтернативні онлайн калькулятори** - результат: ~9,000 ✅

Усі методи дають узгоджені результати в межах округлення.

---

## Додаток: Python код

```python
import numpy as np
from scipy import stats
import math

def calculate_sample_size(p1, p2, alpha=0.05, power=0.80):
    z_alpha = stats.norm.ppf(1 - alpha/2)  # 1.96
    z_beta = stats.norm.ppf(power)          # 0.84
    
    numerator = (z_alpha + z_beta) ** 2
    variance_sum = p1 * (1 - p1) + p2 * (1 - p2)
    diff_squared = (p2 - p1) ** 2
    
    n = numerator * variance_sum / diff_squared
    return math.ceil(n)

# Основний розрахунок
n = calculate_sample_size(p1=0.41, p2=0.4305)
print(f"Sample size per group: {n}")
print(f"Total sample size: {n * 2}")
```

**Вивід:**
```
Sample size per group: 9097
Total sample size: 18194
```

---

**Підготував:** Fefelov  
**Дата:** 31 жовтня 2025 року  
**Курс:** GoIT Product Analytics  
**Завдання:** Homework 5 - Розрахунок розміру вибірки
